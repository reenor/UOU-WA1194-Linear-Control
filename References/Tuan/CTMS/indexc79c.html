<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	
<!-- Mirrored from ctms.engin.umich.edu/CTMS/index.php?example=MotorPosition&section=ControlStateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>

		<script type="text/javascript" src="jquery.js"></script>
					
		<link rel='stylesheet' type='text/css' href='style.css' />
		<script type="text/javascript">
	
			var example = "MotorPosition"; 
			var section = "ControlStateSpace"; 
			var aux = ""; 
			var effects = Boolean(1); 
			var tips = Boolean(1); 
			$.fx.off = !effects;
			
			$(document).keydown(function(e){
				if (!$("#search_field").is(":focus")){
					if (e.keyCode == 39) { 
						window.location = "index7d62.html?example=MotorPosition&amp;section=ControlDigital";
					}
					if (e.keyCode == 37) { 
						window.history.back()
					}
				}
			});		
			
		</script>
			
		<meta http-equiv="Content-Type" Content="text/html; charset=utf-8" />
		<meta http-equiv="PRAGMA" Content="NO-CACHE" />
		
		<title>Control Tutorials for MATLAB and Simulink - Motor Position: State-Space Methods for Controller Design</title>
			
	</head>

	<body>
	
		
		<div id="container">
		
			<form id="search_form"><input id="search_field" type="text" name="q" placeholder="Search Control Tutorials"/></form>
			<form class="option_form" method="post" onclick="submit()"><div>Effects</div><input type="hidden" name="effects" value="0"/><input type="checkbox" name="effects" value="1" checked='true' /></form>
			<form class="option_form" method="post" onclick="submit()"><div>Tips</div><input type="hidden" name="tips" value="0"/><input type="checkbox" name="tips" value="1" checked='true' /></form>	
				
			<div style="clear:both"></div>
		
			<div id="header">
		
				

				
				
				<div id="menu_container">
				
					<ul class="menu">
						<li class="heading" id="Tips"><a href="index80e7.html?aux=Extras_Tips">TIPS</a></li>
						<div class="collapse"><div class="expand">
						</div></div>
					</ul>
				
					<ul class="menu">
						<li class="heading" id="About"><a>ABOUT</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="About_Tutorials"><a href="index64fe.html?aux=About_Tutorials">Tutorials</a></li>
							<li class="item" id="About_Contact"><a href="mailto:ControlTutorialsMatlabSimulink@gmail.com">Contact</a></li>
						</div></div>
					</ul>
					
					<ul class="menu">
						<li class="heading" id="Basics"><a>BASICS</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="Basics_Matlab"><a href="index87b6.html?aux=Basics_Matlab">MATLAB</a></li>
							<li class="item" id="Basics_Simulink"><a href="indexe9ea.html?aux=Basics_Simulink">Simulink</a></li>
						</div></div>
					</ul>
					
					<ul class="menu">
						<li class="heading" id="Index"><a>INDEX</a></li>
						<div class="collapse"><div class="expand">
							<li class="item" id="Index_Tutorials"><a href="index5e52.html?aux=Index_Tutorials">Tutorials</a></li>
							<li class="item" id="Index_Commands"><a href="index111e.html?aux=Index_Commands">Commands</a></li>
							<li class="item" id="Index_Animations"><a href="indexc3c5.html?aux=Index_Animations">Animations</a></li>
							<li class="item" id="Index_Extras"><a href="indexb290.html?aux=Index_Extras">Extras</a></li>
						</div></div>
					</ul>
									
					<ul class="menu">
						<li class="heading" id="Next"><a href="index7d62.html?example=MotorPosition&amp;section=ControlDigital">NEXT&nbsp;&#x25BA;</a></li>
						<div class="collapse"><div class="expand">
						</div></div>
					</ul>
											
				</div>

			</div>
			
			<div id="body_container">
			
				<div id="gradient_container"></div>
			
				<div id="top">
				
					<a href="index1304.html?aux=Home"><img id="CTMS_logo" src="Images/CTMS_logo.png"></a>
				
					<ul class="example">
					
						<li class="item" id="Introduction"><a href="index9b18.html?example=Introduction&amp;section=ControlStateSpace"><img class="icon" src="Images/Introduction_Icon.png"><div class="tab">INTRODUCTION</div></a></li>
						<li class="item" id="CruiseControl"><a href="index1502.html?example=CruiseControl&amp;section=ControlStateSpace"><img class="icon" src="Images/CruiseControl_Icon.png"><div class="tab">CRUISE&nbsp;CONTROL</div></a></li>
						<li class="item" id="MotorSpeed"><a href="indexd22e.html?example=MotorSpeed&amp;section=ControlStateSpace"><img class="icon" src="Images/MotorSpeed_Icon.png"><div class="tab">MOTOR&nbsp;SPEED</div></a></li>
						<li class="item" id="MotorPosition"><a href="indexc79c.html?example=MotorPosition&amp;section=ControlStateSpace"><img class="icon" src="Images/MotorPosition_Icon.png"><div class="tab">MOTOR&nbsp;POSITION</div></a></li>
						<li class="item" id="Suspension"><a href="index7de2.html?example=Suspension&amp;section=ControlStateSpace"><img class="icon" src="Images/Suspension_Icon.png"><div class="tab">SUSPENSION</div></a></li>
						<li class="item" id="InvertedPendulum"><a href="index96a8.html?example=InvertedPendulum&amp;section=ControlStateSpace"><img class="icon" src="Images/InvertedPendulum_Icon.png"><div class="tab">INVERTED&nbsp;PENDULUM</div></a></li>
						<li class="item" id="AircraftPitch"><a href="indexcff8.html?example=AircraftPitch&amp;section=ControlStateSpace"><img class="icon" src="Images/AircraftPitch_Icon.png"><div class="tab">AIRCRAFT&nbsp;PITCH</div></a></li>
						<li class="item" id="BallBeam"><a href="indexfa3e.html?example=BallBeam&amp;section=ControlStateSpace"><img class="icon" src="Images/BallBeam_Icon.png"><div class="tab">BALL&nbsp;&amp;&nbsp;BEAM</div></a></li>
					
					</ul> 
		
				</div>
				
				<div id="content_container">
					<div class="content">
   <div class="content_fx">
      <h1>DC Motor Position: State-Space Methods for Controller Design</h1>
      <!--introduction-->
      <p>Key MATLAB commands used in this tutorial are: <a href="http://www.mathworks.com/help/toolbox/control/ref/ss.html"><tt>ss</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/order.html"><tt>order</tt></a> , <a href="http://www.mathworks.com/help/techdoc/ref/det.html"><tt>det</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/ctrb.html"><tt>ctrb</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/place.html"><tt>place</tt></a> , <a href="http://www.mathworks.com/help/toolbox/control/ref/step.html"><tt>step</tt></a></p>
      <!--/introduction-->
      <h2>Contents</h2>
      <div>
         <ul>
            <li><a href="#7">Designing the full state-feedback controller</a></li>
            <li><a href="#13">Disturbance response</a></li>
            <li><a href="#15">Adding integral action</a></li>
         </ul>
      </div>
      <p>From the main problem, the dynamic equations in state-space form are given below.</p>
      <p><span class="eqn_num">(1)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq39317.png" alt="$$  \frac{d}{dt}\left[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \end{array} \right] =&#xA;\left [\begin{array}{ccc} 0 &amp; 1 &amp; 0 \\ \ \\ 0 &amp; -\frac{b}{J} &amp; \frac{K}{J} \\ \ \\&#xA;0 &amp; -\frac{K}{L} &amp; -\frac{R}{L} \end{array} \right] \left [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \end{array} \right]  +&#xA;\left [\begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ \frac{1}{L} \end{array} \right] V$$"></p>
      <p><span class="eqn_num">(2)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq94451.png" alt="$$  y = [ \begin{array}{ccc}1 &amp; \ 0 &amp; \ 0 \end{array}] \left [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i&#xA;\end{array}\right] $$"></p>
      <p>The above has the form of a standard set of state-space equations as described below.</p>
      <p><span class="eqn_num">(3)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq21756.png" alt="$$   \dot{{\bf x}} = A{\bf x} + Bu $$"></p>
      <p><span class="eqn_num">(4)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq02528.png" alt="$$    y = C\bf{x} $$"></p>
      <p>For the original problem setup and the derivation of the above equations, please refer to the <a href="index9ba6.html?example=MotorPosition&amp;section=SystemModeling">DC Motor Position: System Modeling</a> page
      </p>
      <p>With a 1-radian step reference, the design criteria are the following.</p>
      <div>
         <ul>
            <li>Settling time less than 0.040 seconds</li>
            <li>Overshoot less than 16%</li>
            <li>No steady-state error, even in the presence of a step disturbance input</li>
         </ul>
      </div>
      <p>First create a new <a href="indexd754.html?aux=Extras_Mfile">m-file</a> and type in the following commands (refer to main problem for the details of getting these commands).
      </p><pre class="codeinput">J = 3.2284E-6;
b = 3.5077E-6;
K = 0.0274;
R = 4;
L = 2.75E-6;

A = [0 1 0
    0 -b/J K/J
    0 -K/L -R/L];
B = [0 ; 0 ; 1/L];
C = [1  0  0];
D = 0;
motor_ss = ss(A,B,C,D);
</pre><h2>Designing the full state-feedback controller<a name="7"></a></h2>
      <p>Since all of the state variables in our problem are very easy to measure (simply add an ammeter for current, a tachometer
         for speed, and a potentiometer for position), we can design a full-state feedback controller for the system without worrying
         about having to add an observer. The control law for a full-state feedback system has the form <i>u</i> = <i>r</i> - <i>Kc</i> <b>x</b>. The associated block diagram is given below.
      </p>
      <p><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/figures/statefeedback_motorp.png" alt=""> </p>
      <p>Recall that the characteristic polynomial for this closed-loop system is the determinant of <i>sI</i>-(<i>A-B*Kc</i>) where <i>s</i> is the Laplace variable. Since the matrices <i>A</i> and <i>B*Kc</i> are both 3x3 matrices, there should be 3 poles for the system. This fact can be verified with the MATLAB command <tt>order</tt>. If the given system is controllable, then by designing a full state-feedback controller we can move these three poles anywhere
         we'd like.  Whether the given system is controllable or not can be determined by checking the rank of the controllability
         matrix [ <i>B</i> <i>AB</i> <i>A^2B</i> ...]. The MATLAB command <tt>ctrb</tt> constructs the controllability matrix given <i>A</i> and <i>B</i>. Additionally, the command <tt>rank</tt> determines the rank of a given matrix, though it can be numerically unreliable. Therefore, we will use the command <tt>det</tt> to calculate the determinant of the controllability matrix where a full rank matrix has a non-zero determinant. The following
         commands executed at the command line will verify the system's order and whether or not it is controllable.
      </p><pre class="codeinput">sys_order = order(motor_ss)
determinant = det(ctrb(A,B))
</pre><pre class="codeoutput">sys_order =
     3
determinant =
  -3.4636e+24
</pre><p>From the above, we know that our system is controllable since the determinant of the controllability matrix is not zero and
         hence we can place the system's closed-loop poles anywhere in the s-plane. We will first place the poles at -200, -100+100i
         and -100-100i. By ignoring the effect of the first pole (since it is faster than the other two poles), the dominant poles
         correspond to a second-order system with <i>zeta</i> = 0.5 corresponding to 0.16% overshoot and <i>sigma</i> = 100 which corresponding to a settling time of 0.040 seconds. Once we have determined the pole locations we desire, we can
         use the MATLAB commands <tt>place</tt> or <tt>acker</tt> to determine the controller gain matrix, <i>Kc</i>, to achieve these poles. We will use the command <tt>place</tt> since it is numerically better conditioned than <tt>acker</tt>. However, if we wished to place a pole with multiplicity greater than the rank of the matrix <i>B</i>, then we would have to use the command <tt>acker</tt>. Add the following code to the end of your m-file.
      </p><pre class="codeinput">p1 = -100+100i;
p2 = -100-100i;
p3 = -200;
Kc = place(A,B,[p1, p2, p3])
</pre><pre class="codeoutput">Kc =
    0.0013   -0.0274   -3.9989
</pre><p>Referring back to the equations and schematic at the top of the page, we see that employing a state-feedback law <i>u</i> = <i>r</i> - <i>Kc</i> <b>x</b>, the state-space equations become the following.
      </p>
      <p><span class="eqn_num">(5)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq78094.png" alt="$$   \dot{{\bf x}} = (A - BK_c){\bf x} + Br $$"></p>
      <p><span class="eqn_num">(6)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq02528.png" alt="$$    y = C\bf{x} $$"></p>
      <p>We can generate the closed-loop response to a step reference by adding the following lines to the end of your m-file. Run
         your m-file in the command window and you should generate a plot like the one shown below.
      </p><pre class="codeinput">t = 0:0.001:0.05;
sys_cl = ss(A-B*Kc,B,C,D);
step(sys_cl,t)
</pre><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_01.png" alt=""> <p>Note that our given requirements are not met, specifically, the steady-state error is much too large. Before we address this,
         let's first look at the system's disturbance response.
      </p>
      <h2>Disturbance response<a name="13"></a></h2>
      <p>In order to observe the system's disturbance response, we must provide the proper input to the system. In this case, a disturbance
         is physically a load torque that acts on the inertia of the motor. This load torque acts as an additive term in the second
         state equation (which gets divided by <i>J</i>, as do all the other terms in this equation). We can simulate this simply by modifying our closed-loop input matrix, <i>B</i>, to have a 1 / <i>J</i> in the second row assuming that our current input is only the disturbance.
      </p>
      <p>Add the following lines to your m-file and re-run.</p><pre class="codeinput">dist_cl = ss(A-B*Kc,[0; 1/J ; 0], C, D);
step(dist_cl,t)
</pre><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_02.png" alt=""> <p>Notice that the error due to the step disturbance is non-zero. Therefore, this will also need to be compensated for.</p>
      <h2>Adding integral action<a name="15"></a></h2>
      <p>From prior examples, we know that if we put an extra integrator in series with the plant it can remove the steady-state error
         due to a step reference. If the integrator comes before the injection of the disturbance, it will also cancel a step disturbance
         input in steady state. This changes our control structure so that it now resembles the block diagram shown in the following
         figure.
      </p>
      <p><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/figures/statefeedback_w_int.png" alt=""> </p>
      <p>We can model the addition of this integrator by augmenting our state equations with an extra state for the integral of the
         error which we will identify with the variable <i>w</i>. This adds an extra state equation, where the derivative of this state is then just the error, <i>e = y - r</i> where <i>y = theta</i>. This equation will be placed at the bottom of our matrices. The reference <i>r</i>, therefore, now appears as an additional input to our system. The output of the system remains the same.
      </p>
      <p><span class="eqn_num">(7)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq43418.png" alt="$$ \frac{d}{dt}\left[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w \end{array}  \right] =&#xA;\left[ \begin{array}{cccc} 0 &amp; 1 &amp; 0 &amp; 0 \\ \ \\ 0 &amp; -\frac{b}{J} &amp;&#xA;\frac{K}{J} &amp; 0 \\ \ \\ 0 &amp; -\frac{K}{L} &amp; -\frac{R}{L} &amp; 0 \\ \ \\ 1 &amp; 0 &amp; 0 &amp; 0 \end{array} \right] \left&#xA;[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w&#xA;\end{array} \right] $$"></p>
      <p><span class="eqn_num">(8)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq97457.png" alt="$$ + \left[ \begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ \frac{1}{L} \\ \ \\ 0&#xA;\end{array} \right] V&#xA;+ \left[ \begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ 0 \\ \ \\ -1 \end{array} \right] r $$"></p>
      <p><span class="eqn_num">(9)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq63362.png" alt="$$  y = [ \begin{array}{cccc} 1 &amp; \ 0 &amp; \ 0 &amp; \ 0 \end{array}] \left&#xA;[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w&#xA;\end{array}\right] $$"></p>
      <p>These equations represent the dynamics of the system before the loop is closed. We will refer to the system matrices in this
         equation that are augmented with the additional integrator state as <i>Aa</i>, <i>Ba</i>, <i>Ca</i>, and <i>Da</i>. The vector multiplying the reference input <i>r</i> will be referred to as <i>Br</i>. We will refer to the state vector of the augmented system as <b>xa</b>. Note that the reference, <i>r</i>, does not affect the states (except the integrator state) or the output of the plant. This is expected since there is no
         path from the reference to the plant input, <i>u</i>, without implementing the state-feedback gain matrix <i>Kc</i>.
      </p>
      <p>In order to find the closed-loop equations, we have to look at how the input, <i>u</i>, affects the plant. In this case, it affects the system in exactly the same manner as in the unaugmented equations except
         now <i>u</i> = <i>-Kc</i> <b>x</b> - <i>Ki</i> <i>w</i>. We can also rewrite this in terms of our augmented state as <i>u</i> = <i>-Ka</i> <b>xa</b> where <i>Ka</i> = [ <i>Kc</i> <i>Ki</i> ]. Substituting this <i>u</i> into the equations above provides the following closed-loop equations.
      </p>
      <p><span class="eqn_num">(10)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq12446.png" alt="$$ \dot{{\bf x}}_{a} = (A_{a} - B_{a}K_{a}){\bf x}_{a} + B_{r}r $$"></p>
      <p><span class="eqn_num">(11)</span><img class="display_eqn" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_eq41710.png" alt="$$ y = C_{a}{\bf x}_{a} $$"></p>
      <p>In the above, the integral of the error will be fed back, and will result in the steady-state error being reduced to zero.
         Now we must redesign our controller to account for the augmented state vector. Since we need to place each pole of the system,
         we will place the pole associated with the additional integrator state at -300, which will be faster than the other poles.
      </p>
      <p>Add the following lines to your m-file which reflect the closed-loop equations presented above. Note that since the closed-loop
         transition matrix <i>Aa-Ba*Ka</i> depends on <i>Ba</i>, it will be used in the <tt>place</tt> command rather than <i>Br</i>. Running your m-file will then produce the plot shown below.
      </p><pre class="codeinput">Aa = [0 1 0 0
      0 -b/J K/J 0
      0 -K/L -R/L 0
      1 0 0 0];
Ba = [0 ; 0 ; 1/L ; 0 ];
Br = [0 ; 0 ; 0; -1];
Ca = [1 0 0 0];
Da = [0];

p4 = -300;
Ka = place(Aa,Ba,[p1,p2,p3,p4]);

t = 0:0.001:.05;
sys_cl = ss(Aa-Ba*Ka,Br,Ca,Da);
step(sys_cl,t)
</pre><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_03.png" alt=""> <p>To observe the disturbance response, we use a similar approach to that used without the integral action.</p><pre class="codeinput">dist_cl = ss(Aa-Ba*Ka,[0 ; 1/J ; 0; 0],Ca,Da);
step(dist_cl,t)
</pre><img class="figure"vspace="5" hspace="5" src="Content/MotorPosition/Control/StateSpace/html/MotorPosition_ControlStateSpace_04.png" alt=""> <p>We can see that all of the design specifications are close to being met by this controller. The settle time may be a little
         large, but by placing the closed-loop poles a little farther to the left in the complex <i>s</i>-plane, this requirement can also be met.
      </p>
      <p class="footer"><br>
         Published with MATLAB&reg; 7.14<br></p>
   </div>
</div>
<!--
##### SOURCE BEGIN #####
%% DC Motor Position: State-Space Methods for Controller Design
%
% Key MATLAB commands used in this tutorial are:
% <http://www.mathworks.com/help/toolbox/control/ref/ss.html |ss|> , 
% <http://www.mathworks.com/help/toolbox/control/ref/order.html |order|> ,
% <http://www.mathworks.com/help/techdoc/ref/det.html |det|> ,
% <http://www.mathworks.com/help/toolbox/control/ref/ctrb.html |ctrb|> , 
% <http://www.mathworks.com/help/toolbox/control/ref/place.html |place|> , 
% <http://www.mathworks.com/help/toolbox/control/ref/step.html |step|> 
%
%%
% From the main problem, the dynamic equations in state-space form are
% given below.
%%
%
% $$  \frac{d}{dt}\left[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \end{array} \right] = 
% \left [\begin{array}{ccc} 0 & 1 & 0 \\ \ \\ 0 & -\frac{b}{J} & \frac{K}{J} \\ \ \\
% 0 & -\frac{K}{L} & -\frac{R}{L} \end{array} \right] \left [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \end{array} \right]  + 
% \left [\begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ \frac{1}{L} \end{array} \right] V$$
%
% $$  y = [ \begin{array}{ccc}1 & \ 0 & \ 0 \end{array}] \left [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i
% \end{array}\right] $$
%
%%
% The above has the form of a standard set of state-space equations as
% described below.
%
% $$   \dot{{\bf x}} = A{\bf x} + Bu $$
%
% $$    y = C\bf{x} $$
%%
% For the original problem setup and the derivation of the above equations,
% please refer to the
% < ?example=MotorPosition&section=SystemModeling
% DC Motor Position: System Modeling> page  
%
%%
% With a 1-radian step reference, the design criteria are the following.
%
% * Settling time less than 0.040 seconds
% * Overshoot less than 16%
% * No steady-state error, even in the presence of a step disturbance input
%
%%
% First create a new < ?aux=Extras_Mfile
% m-file> and type in the following commands (refer to main
% problem for the details of getting these commands). 

J = 3.2284E-6;
b = 3.5077E-6;
K = 0.0274;
R = 4;
L = 2.75E-6;

A = [0 1 0
    0 -b/J K/J
    0 -K/L -R/L];
B = [0 ; 0 ; 1/L];
C = [1  0  0];
D = 0;
motor_ss = ss(A,B,C,D);
    
%% Designing the full state-feedback controller
%
% Since all of the state variables in our problem are very easy to measure
% (simply add an ammeter for current, a tachometer for speed, and a
% potentiometer for position), we can design a full-state feedback
% controller for the system without worrying about having to add an
% observer. The control law for a full-state feedback system has the form
% _u_ = _r_ - _Kc_ *x*. The associated block diagram is given below. 
%
% <<Content/MotorPosition/Control/StateSpace/figures/statefeedback_motorp.png>>
%
%%
% Recall that the characteristic polynomial for this closed-loop system is
% the determinant of _sI_-(_A-B*Kc_) where _s_ is the Laplace variable. Since
% the matrices _A_ and _B*Kc_ are both 3x3 matrices, there should be 3 poles
% for the system. This fact can be verified with the MATLAB command
% |order|. If the given system is controllable, then by designing a 
% full state-feedback controller we can move these three poles anywhere
% we'd like.  Whether the given system is controllable or not can be
% determined by checking the rank of the controllability matrix [ _B_ _AB_ 
% _A^2B_ ...]. The MATLAB command |ctrb| constructs the controllability matrix
% given _A_ and _B_. Additionally, the command |rank| determines the rank
% of a given matrix, though it can be numerically unreliable. Therefore, we
% will use the command |det| to calculate the determinant of the
% controllability matrix where a full rank matrix has a non-zero determinant.
% The following commands executed at the command line will verify the
% system's order and whether or not it is controllable.

sys_order = order(motor_ss)
determinant = det(ctrb(A,B))

%%
% From the above, we know that our system is controllable since the
% determinant of the controllability matrix is not zero and hence we can place
% the system's closed-loop poles anywhere in the s-plane. We will first
% place the poles at -200, -100+100i and -100-100i. By ignoring the
% effect of the first pole (since it is faster than the other two poles),
% the dominant poles correspond to a second-order system with _zeta_ = 0.5
% corresponding to 0.16% overshoot and _sigma_ = 100 which corresponding to a
% settling time of 0.040 seconds. Once we have determined the pole locations we
% desire, we can use the MATLAB commands |place| or |acker| to determine
% the controller gain matrix, _Kc_, to achieve these poles. We will use the
% command |place| since it is numerically better conditioned than |acker|.
% However, if we wished to place a pole with multiplicity greater than the
% rank of the matrix _B_, then we would have to use the command |acker|.
% Add the following code to the end of your m-file.  

p1 = -100+100i;
p2 = -100-100i;
p3 = -200;
Kc = place(A,B,[p1, p2, p3])

%%      
% Referring back to the equations and schematic at the top of the page, we
% see that employing a state-feedback law _u_ = _r_ - _Kc_ *x*, the state-space
% equations become the following.  
%
% $$   \dot{{\bf x}} = (A - BK_c){\bf x} + Br $$
%
% $$    y = C\bf{x} $$
%
%%
% We can generate the closed-loop response to a step reference by adding
% the following lines to the end of your m-file. Run your m-file in the
% command window and you should generate a plot like the one shown below.

t = 0:0.001:0.05;
sys_cl = ss(A-B*Kc,B,C,D);
step(sys_cl,t)

%%
% Note that our given requirements are not met, specifically, the
% steady-state error is much too large. Before we address this, let's first
% look at the system's disturbance response.

%% Disturbance response
% In order to observe the system's disturbance response, we must provide
% the proper input to the system. In this case, a disturbance is physically
% a load torque that acts on the inertia of the motor. This load torque
% acts as an additive term in the second state equation (which gets divided
% by _J_, as do all the other terms in this equation). We can simulate this
% simply by modifying our closed-loop input matrix, _B_, to have a 1 / _J_ in
% the second row assuming that our current input is only the disturbance.
%
% Add the following lines to your m-file and re-run.

dist_cl = ss(A-B*Kc,[0; 1/J ; 0], C, D);
step(dist_cl,t)

%%
% Notice that the error due to the step disturbance is non-zero. Therefore,
% this will also need to be compensated for.
%
%% Adding integral action
% From prior examples, we know that if we put an extra integrator in series
% with the plant it can remove the steady-state error due to a step reference. If
% the integrator comes before the injection of the disturbance, it will
% also cancel a step disturbance input in steady state. This changes our control
% structure so that it now resembles the block diagram shown in the following figure.   
%
% <<Content/MotorPosition/Control/StateSpace/figures/statefeedback_w_int.png>>
%
%% 
% We can model the addition of this integrator by augmenting our state
% equations with an extra state for the integral of the error which we will
% identify with the variable _w_. This adds an 
% extra state equation, where the derivative of this state is then just the
% error, _e = y - r_ where _y = theta_. This equation will be placed at the
% bottom of our matrices. The reference _r_, therefore, now appears as an
% additional input to our system. The output of the system remains the same.  
%
% $$ \frac{d}{dt}\left[\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w \end{array}  \right] = 
% \left[ \begin{array}{cccc} 0 & 1 & 0 & 0 \\ \ \\ 0 & -\frac{b}{J} &
% \frac{K}{J} & 0 \\ \ \\ 0 & -\frac{K}{L} & -\frac{R}{L} & 0 \\ \ \\ 1 & 0 & 0 & 0 \end{array} \right] \left  
% [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w
% \end{array} \right] $$
%
% $$ + \left[ \begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ \frac{1}{L} \\ \ \\ 0
% \end{array} \right] V 
% + \left[ \begin{array}{c} 0 \\ \ \\ 0 \\ \ \\ 0 \\ \ \\ -1 \end{array} \right] r $$
%
% $$  y = [ \begin{array}{cccc} 1 & \ 0 & \ 0 & \ 0 \end{array}] \left
% [\begin{array}{c} \theta \\ \ \\ \dot{\theta} \\ \ \\ i \\ \ \\ w
% \end{array}\right] $$
%
%
%%
% These equations represent the dynamics of the system before the loop is
% closed. We will refer to the system matrices in this equation
% that are augmented with the additional integrator state as _Aa_, _Ba_, _Ca_, and
% _Da_. The vector multiplying the reference input _r_ will be referred to as
% _Br_. We will refer to the state vector of the augmented system as *xa*.  
% Note that the reference, _r_, does not affect the states (except the
% integrator state) or the output of the plant. This is expected since
% there is no path from the reference to the plant input, _u_, without
% implementing the state-feedback gain matrix _Kc_.        
%
%%
% In order to find the closed-loop equations, we have to look at how the
% input, _u_, affects the plant. In this case, it affects the system in
% exactly the same manner as in the unaugmented equations except now _u_ =
% _-Kc_ *x* - _Ki_ _w_. We can also rewrite this in terms of our augmented
% state as _u_ = _-Ka_ *xa* where _Ka_ = [ _Kc_ _Ki_ ]. Substituting this
% _u_ into the equations above provides the following closed-loop
% equations.
%
% $$ \dot{{\bf x}}_{a} = (A_{a} - B_{a}K_{a}){\bf x}_{a} + B_{r}r $$
%
% $$ y = C_{a}{\bf x}_{a} $$
%
%%
% In the above, the integral of the error will be fed back, and will result
% in the steady-state error being reduced to zero. Now we must redesign our
% controller to account for the augmented state vector. Since we need to
% place each pole of the system, we will place the pole associated with the
% additional integrator state at -300, which will be faster than the other poles.     
%
% Add the following lines to your m-file which reflect the closed-loop
% equations presented above. Note that since the closed-loop
% transition matrix _Aa-Ba*Ka_ depends on _Ba_, it will be used in the
% |place| command rather than _Br_. Running your m-file will then produce the
% plot shown below.

Aa = [0 1 0 0
      0 -b/J K/J 0
      0 -K/L -R/L 0
      1 0 0 0];
Ba = [0 ; 0 ; 1/L ; 0 ];
Br = [0 ; 0 ; 0; -1];
Ca = [1 0 0 0];
Da = [0];

p4 = -300;
Ka = place(Aa,Ba,[p1,p2,p3,p4]);

t = 0:0.001:.05;
sys_cl = ss(Aa-Ba*Ka,Br,Ca,Da);
step(sys_cl,t)

%%      
% To observe the disturbance response, we use a similar approach to that
% used without the integral action.  

dist_cl = ss(Aa-Ba*Ka,[0 ; 1/J ; 0; 0],Ca,Da);
step(dist_cl,t)

%%
% We can see that all of the design specifications are close to being met
% by this controller. The settle time may be a little large, but by placing
% the closed-loop poles a little farther to the left in the complex
% _s_-plane, this requirement can also be met.

##### SOURCE END #####
-->				</div>
				
				<div id="left">

					<ul class="section">
						<li class="heading" id="System">SYSTEM<img class="section_heading_arrow" src="Images/section_heading_arrow.png"/></li>
						<li class="item" id="SystemModeling"><a href="index9ba6.html?example=MotorPosition&amp;section=SystemModeling">MODELING<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="SystemAnalysis"><a href="indexb7ed.html?example=MotorPosition&amp;section=SystemAnalysis">ANALYSIS<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
					</ul>
					
					<div class="section_break"></div>

					<ul class="section">
						<li class="heading" id="Control">CONTROL<img class="section_heading_arrow" src="Images/section_heading_arrow.png"/></li>
						<li class="item" id="ControlPID"><a href="indexe534.html?example=MotorPosition&amp;section=ControlPID">PID<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="ControlRootLocus"><a href="index3c83.html?example=MotorPosition&amp;section=ControlRootLocus">ROOT&nbsp;LOCUS<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="ControlFrequency"><a href="index1ae7.html?example=MotorPosition&amp;section=ControlFrequency">FREQUENCY<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="ControlStateSpace"><a href="indexc79c.html?example=MotorPosition&amp;section=ControlStateSpace">STATE-SPACE<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="ControlDigital"><a href="index7d62.html?example=MotorPosition&amp;section=ControlDigital">DIGITAL<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
					</ul>
					
					<div class="section_break"></div>

					<ul class="section">
						<li class="heading" id="Simulink">SIMULINK<img class="section_heading_arrow" src="Images/section_heading_arrow.png"/></li>
						<li class="item" id="SimulinkModeling"><a href="index6d09.html?example=MotorPosition&amp;section=SimulinkModeling">MODELING<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
						<li class="item" id="SimulinkControl"><a href="index4c9e.html?example=MotorPosition&amp;section=SimulinkControl">CONTROL<img class="section_arrow" src="Images/section_arrow.png"/></a></li>
					</ul>
		
				</div>
			
				<div style="clear:both"></div>
				
				<div id="bottombar"><span style="color:#FF5500;font-weight:bold">.</div>
				
			</div>
			
		</div>
	
		<script type="text/javascript" src="script.js"></script>
						
	</body>
	

<!-- Mirrored from ctms.engin.umich.edu/CTMS/index.php?example=MotorPosition&section=ControlStateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

	StateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

			<script type="text/javascript" src="script.js"></script>
						
	</body>
	

<!-- Mirrored from ctms.engin.umich.edu/CTMS/index.php?example=MotorPosition&section=ControlStateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

	StateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

	pier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

	StateSpace by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 19 Jun 2014 21:10:59 GMT -->
</html>

	